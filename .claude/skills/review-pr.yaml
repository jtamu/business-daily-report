name: review-pr
description: GitHubのプルリクエストをレビューします
args:
  - name: pr_number
    description: レビューするプルリクエスト番号
    required: true
    type: string

prompt: |
  以下の手順でプルリクエスト #{pr_number} をレビューしてください：

  1. **PR情報の取得**
     - `gh pr view {pr_number}` でPRの詳細情報を取得
     - タイトル、説明、変更ファイル数、追加/削除行数を確認

  2. **差分の取得と分析**
     - `gh pr diff {pr_number}` で変更内容を取得
     - コードの変更内容を詳細に分析

  3. **レビュー観点**
     以下の観点からコードをレビューしてください：

     **コード品質**
     - コードの可読性と保守性
     - 命名規則の適切性
     - コメントやドキュメントの適切性

     **設計とアーキテクチャ**
     - プロジェクトの設計方針との整合性（CLAUDE.md、docs/配下のドキュメントを参照）
     - 適切な責務の分離
     - 再利用性と拡張性

     **セキュリティ**
     - SQLインジェクション、XSS等の脆弱性
     - 認証・認可の適切な実装
     - 機密情報の漏洩リスク
     - パスワードやシークレットのハードコーディング

     **パフォーマンス**
     - 不要な処理やループ
     - データベースクエリの最適化
     - N+1問題の有無

     **テスト**
     - テストケースの網羅性
     - エッジケースの考慮

     **プロジェクト要件との整合性**
     - docs/requirements.md の要件定義との整合性
     - docs/api-specification.yaml のAPI仕様との整合性
     - docs/screen-design.md の画面仕様との整合性

     **ビジネスルール**
     - 日報の重複防止、編集期限（7日以内）等のルール遵守
     - 権限制御の適切な実装

  4. **フィードバックの提供**
     以下の形式でレビュー結果を提供してください：

     ## PR概要
     - タイトル、説明、変更規模の要約

     ## 良い点 ✅
     - 優れている実装や改善点をリストアップ

     ## 改善提案 💡
     - 重大度別に整理（Critical / Major / Minor）
     - 各項目に対して：
       - 問題点の説明
       - 該当コードの位置（ファイル名:行番号）
       - 推奨される修正方法
       - 修正例（必要に応じて）

     ## セキュリティ懸念 🔒
     - セキュリティ上の問題があれば詳細に記載

     ## 総合評価
     - マージの可否についての推奨
     - 総評とコメント

  5. **コメント投稿（オプション）**
     - レビュー結果をGitHubのPRにコメントとして投稿するか確認
     - ユーザーが希望する場合は `gh pr comment {pr_number}` でコメントを投稿

  重要：
  - プロジェクトのCLAUDE.mdとdocs/配下のドキュメントを参照して、プロジェクトの要件や設計方針を理解してからレビューを行ってください
  - 建設的で具体的なフィードバックを心がけてください
  - 単なる指摘だけでなく、なぜそれが問題なのか、どう改善すべきかを明確に説明してください
