# 営業日報システム テスト仕様書

## 1. テスト計画概要

### 1.1 目的
営業日報システムが要件定義書に記載された仕様を満たし、期待通りに動作することを確認する。

### 1.2 テスト範囲
- 機能テスト
- 画面テスト
- APIテスト
- 権限テスト
- バリデーションテスト
- 非機能テスト（パフォーマンス、セキュリティ）

### 1.3 テスト環境

| 項目 | 内容 |
|------|------|
| OS | Ubuntu 22.04 LTS |
| Webサーバー | Nginx 1.24 |
| アプリケーションサーバー | Node.js 20.x / Python 3.11 |
| データベース | PostgreSQL 15.x / MySQL 8.0 |
| ブラウザ | Chrome（最新版）、Firefox（最新版）、Safari（最新版）、Edge（最新版） |

### 1.4 テストデータ

#### ユーザー
| user_id | name | email | role | password |
|---------|------|-------|------|----------|
| 1 | 田中花子 | staff1@example.com | staff | Test1234! |
| 2 | 佐藤太郎 | staff2@example.com | staff | Test1234! |
| 3 | 山田部長 | manager@example.com | manager | Test1234! |

#### 顧客
| customer_id | company_name | contact_person | phone | email |
|-------------|-------------|----------------|--------|-------|
| 1 | 株式会社テストA | 鈴木一郎 | 03-1111-1111 | suzuki@test-a.co.jp |
| 2 | 株式会社テストB | 高橋二郎 | 03-2222-2222 | takahashi@test-b.co.jp |
| 3 | 株式会社テストC | 伊藤三郎 | 03-3333-3333 | ito@test-c.co.jp |

---

## 2. 機能テスト

### 2.1 認証機能

#### TC-AUTH-001: ログイン成功（一般営業）
**前提条件:**
- 有効なユーザーアカウントが存在する（staff1@example.com）

**テスト手順:**
1. ログイン画面を開く
2. メールアドレス: `staff1@example.com` を入力
3. パスワード: `Test1234!` を入力
4. ログインボタンをクリック

**期待結果:**
- ダッシュボード画面に遷移する
- ヘッダーに「田中花子」と表示される
- アクセストークンが取得できる

**優先度:** 高

---

#### TC-AUTH-002: ログイン成功（上長）
**前提条件:**
- 有効な上長アカウントが存在する（manager@example.com）

**テスト手順:**
1. ログイン画面を開く
2. メールアドレス: `manager@example.com` を入力
3. パスワード: `Test1234!` を入力
4. ログインボタンをクリック

**期待結果:**
- ダッシュボード画面に遷移する
- ヘッダーに「山田部長」と表示される
- ナビゲーションに「営業一覧」リンクが表示される

**優先度:** 高

---

#### TC-AUTH-003: ログイン失敗（パスワード誤り）
**前提条件:**
- 有効なユーザーアカウントが存在する

**テスト手順:**
1. ログイン画面を開く
2. メールアドレス: `staff1@example.com` を入力
3. パスワード: `WrongPassword` を入力
4. ログインボタンをクリック

**期待結果:**
- ログイン画面に留まる
- エラーメッセージ「メールアドレスまたはパスワードが正しくありません」が表示される

**優先度:** 高

---

#### TC-AUTH-004: ログイン失敗（存在しないユーザー）
**前提条件:**
- なし

**テスト手順:**
1. ログイン画面を開く
2. メールアドレス: `nonexist@example.com` を入力
3. パスワード: `Test1234!` を入力
4. ログインボタンをクリック

**期待結果:**
- ログイン画面に留まる
- エラーメッセージ「メールアドレスまたはパスワードが正しくありません」が表示される

**優先度:** 高

---

#### TC-AUTH-005: ログアウト
**前提条件:**
- ログイン済み

**テスト手順:**
1. ダッシュボード画面を表示
2. ヘッダーのログアウトボタンをクリック

**期待結果:**
- ログイン画面に遷移する
- アクセストークンが無効化される
- 認証が必要なページにアクセスするとログイン画面にリダイレクトされる

**優先度:** 高

---

### 2.2 日報管理機能

#### TC-REPORT-001: 日報作成（正常系）
**前提条件:**
- 一般営業でログイン済み（staff1@example.com）
- 本日の日報が未作成

**テスト手順:**
1. ダッシュボードの「新規日報作成」ボタンをクリック
2. 報告日: 本日の日付（自動入力）
3. Problem: 「新規顧客の開拓が難航している」を入力
4. Plan: 「既存顧客へのフォローアップを強化する」を入力
5. 訪問記録1
   - 顧客: 「株式会社テストA」を選択
   - 訪問内容: 「新製品の提案を実施」を入力
6. 「追加」ボタンをクリック
7. 訪問記録2
   - 顧客: 「株式会社テストB」を選択
   - 訪問内容: 「既存契約の更新について打ち合わせ」を入力
8. 保存ボタンをクリック

**期待結果:**
- 日報一覧画面に遷移する
- 成功メッセージ「日報を作成しました」が表示される
- 作成した日報が一覧に表示される

**優先度:** 高

---

#### TC-REPORT-002: 日報作成（訪問記録なしでエラー）
**前提条件:**
- 一般営業でログイン済み
- 本日の日報が未作成

**テスト手順:**
1. 日報作成画面を開く
2. Problem、Planを入力
3. 訪問記録を追加せずに保存ボタンをクリック

**期待結果:**
- 画面遷移しない
- エラーメッセージ「訪問記録を1件以上追加してください」が表示される

**優先度:** 高

---

#### TC-REPORT-003: 日報作成（同じ日付で重複エラー）
**前提条件:**
- 一般営業でログイン済み
- 本日の日報が既に作成済み

**テスト手順:**
1. 日報作成画面を開く
2. 報告日: 本日の日付
3. Problem、Plan、訪問記録を入力
4. 保存ボタンをクリック

**期待結果:**
- 画面遷移しない
- エラーメッセージ「この日付の日報は既に作成されています」が表示される

**優先度:** 高

---

#### TC-REPORT-004: 日報編集（正常系）
**前提条件:**
- 一般営業でログイン済み
- 自分の日報が作成済み（3日前）

**テスト手順:**
1. 日報一覧から自分の日報を選択
2. 日報詳細画面で「編集」ボタンをクリック
3. Problem を「売上目標の達成が厳しい」に変更
4. 訪問記録を1件追加
5. 保存ボタンをクリック

**期待結果:**
- 日報詳細画面に遷移する
- 成功メッセージ「日報を更新しました」が表示される
- 変更内容が反映されている

**優先度:** 高

---

#### TC-REPORT-005: 日報編集（7日経過後でエラー）
**前提条件:**
- 一般営業でログイン済み
- 自分の日報が作成済み（8日前）

**テスト手順:**
1. 日報詳細画面を開く

**期待結果:**
- 編集ボタンが表示されない、または無効化されている
- 編集しようとした場合、エラーメッセージ「作成から7日以上経過した日報は編集できません」が表示される

**優先度:** 中

---

#### TC-REPORT-006: 日報削除（正常系）
**前提条件:**
- 一般営業でログイン済み
- 自分の日報が作成済み（3日前）

**テスト手順:**
1. 日報詳細画面を開く
2. 削除ボタンをクリック
3. 確認ダイアログで「OK」をクリック

**期待結果:**
- 日報一覧画面に遷移する
- 成功メッセージ「日報を削除しました」が表示される
- 削除した日報が一覧から消えている

**優先度:** 中

---

#### TC-REPORT-007: 日報一覧取得（一般営業）
**前提条件:**
- 一般営業でログイン済み（staff1@example.com）
- 複数の日報が存在（自分: 5件、他人: 3件）

**テスト手順:**
1. 日報一覧画面を開く

**期待結果:**
- 自分の日報のみ表示される（5件）
- 他人の日報は表示されない
- 営業担当者の列は表示されない

**優先度:** 高

---

#### TC-REPORT-008: 日報一覧取得（上長）
**前提条件:**
- 上長でログイン済み（manager@example.com）
- 複数の日報が存在（staff1: 5件、staff2: 3件）

**テスト手順:**
1. 日報一覧画面を開く

**期待結果:**
- 全ての日報が表示される（8件）
- 営業担当者の列が表示される
- 検索条件に「営業担当者」のドロップダウンが表示される

**優先度:** 高

---

#### TC-REPORT-009: 日報検索（期間指定）
**前提条件:**
- ログイン済み
- 複数の日報が存在（2026-01-01〜2026-01-31）

**テスト手順:**
1. 日報一覧画面を開く
2. 報告日（開始）: `2026-01-10` を入力
3. 報告日（終了）: `2026-01-20` を入力
4. 検索ボタンをクリック

**期待結果:**
- 2026-01-10〜2026-01-20の期間の日報のみ表示される

**優先度:** 中

---

#### TC-REPORT-010: 日報詳細表示
**前提条件:**
- ログイン済み
- 日報が作成済み（訪問記録2件、コメント1件）

**テスト手順:**
1. 日報一覧から対象の日報を選択
2. 詳細ボタンをクリック

**期待結果:**
- 日報詳細画面が表示される
- Problem、Planが表示される
- 訪問記録が順序通りに2件表示される
- コメントが1件表示される

**優先度:** 高

---

### 2.3 訪問記録機能

#### TC-VISIT-001: 訪問記録追加
**前提条件:**
- 日報作成画面を表示中

**テスト手順:**
1. 初期状態で訪問記録入力欄が1つ表示されている
2. 顧客を選択し、訪問内容を入力
3. 「追加」ボタンをクリック

**期待結果:**
- 新しい訪問記録入力欄が追加される
- 既存の入力内容は保持される

**優先度:** 高

---

#### TC-VISIT-002: 訪問記録削除
**前提条件:**
- 日報作成画面で訪問記録が3件入力済み

**テスト手順:**
1. 2番目の訪問記録の「削除」ボタンをクリック

**期待結果:**
- 2番目の訪問記録が削除される
- 1番目と3番目の訪問記録は残る
- 順序が適切に調整される

**優先度:** 中

---

#### TC-VISIT-003: 訪問記録の順序
**前提条件:**
- 日報詳細画面を表示中
- 訪問記録が3件存在（訪問順序: 1, 2, 3）

**テスト手順:**
1. 訪問記録の表示順序を確認

**期待結果:**
- visit_orderの昇順で表示される（1 → 2 → 3）

**優先度:** 中

---

### 2.4 コメント機能

#### TC-COMMENT-001: コメント投稿（上長）
**前提条件:**
- 上長でログイン済み
- 日報詳細画面を表示中

**テスト手順:**
1. コメント入力欄に「新規顧客開拓について、来週ミーティングしましょう」を入力
2. 投稿ボタンをクリック

**期待結果:**
- 画面が再表示される
- 投稿したコメントがコメント一覧に表示される
- 投稿者名、投稿日時が表示される

**優先度:** 高

---

#### TC-COMMENT-002: コメント投稿（一般営業でエラー）
**前提条件:**
- 一般営業でログイン済み
- 日報詳細画面を表示中

**テスト手順:**
1. コメント投稿欄を確認

**期待結果:**
- コメント投稿欄が表示されない
- APIでコメント投稿を試みた場合、403 Forbiddenエラーが返される

**優先度:** 高

---

#### TC-COMMENT-003: コメント編集
**前提条件:**
- 上長でログイン済み
- 自分が投稿したコメントが存在

**テスト手順:**
1. コメントの編集ボタンをクリック
2. 内容を「ミーティングは来週水曜日でお願いします」に変更
3. 保存ボタンをクリック

**期待結果:**
- コメントが更新される
- 更新日時が表示される

**優先度:** 中

---

#### TC-COMMENT-004: コメント削除
**前提条件:**
- 上長でログイン済み
- 自分が投稿したコメントが存在

**テスト手順:**
1. コメントの削除ボタンをクリック
2. 確認ダイアログで「OK」をクリック

**期待結果:**
- コメントが削除される
- コメント一覧から消える

**優先度:** 中

---

### 2.5 顧客マスタ機能

#### TC-CUSTOMER-001: 顧客登録（正常系）
**前提条件:**
- ログイン済み

**テスト手順:**
1. 顧客一覧画面で「新規登録」ボタンをクリック
2. 以下を入力
   - 会社名: 株式会社新規顧客
   - 担当者名: 新規太郎
   - 電話番号: 03-4444-4444
   - メールアドレス: shinki@new-customer.co.jp
   - 住所: 東京都渋谷区1-2-3
3. 保存ボタンをクリック

**期待結果:**
- 顧客一覧画面に遷移する
- 成功メッセージ「顧客を登録しました」が表示される
- 登録した顧客が一覧に表示される

**優先度:** 高

---

#### TC-CUSTOMER-002: 顧客登録（会社名未入力でエラー）
**前提条件:**
- 顧客登録画面を表示中

**テスト手順:**
1. 会社名を空欄のまま、他の項目を入力
2. 保存ボタンをクリック

**期待結果:**
- 画面遷移しない
- エラーメッセージ「会社名は必須です」が表示される

**優先度:** 高

---

#### TC-CUSTOMER-003: 顧客編集
**前提条件:**
- ログイン済み
- 顧客が登録済み

**テスト手順:**
1. 顧客一覧から対象の顧客の編集ボタンをクリック
2. 電話番号を変更
3. 保存ボタンをクリック

**期待結果:**
- 顧客一覧画面に遷移する
- 成功メッセージ「顧客を更新しました」が表示される
- 変更が反映される

**優先度:** 中

---

#### TC-CUSTOMER-004: 顧客削除
**前提条件:**
- ログイン済み
- 顧客が登録済み（訪問記録がない）

**テスト手順:**
1. 顧客一覧から対象の顧客の削除ボタンをクリック
2. 確認ダイアログで「OK」をクリック

**期待結果:**
- 顧客が削除される
- 成功メッセージ「顧客を削除しました」が表示される

**優先度:** 中

---

#### TC-CUSTOMER-005: 顧客検索（会社名）
**前提条件:**
- ログイン済み
- 複数の顧客が登録済み

**テスト手順:**
1. 顧客一覧画面で会社名に「テストA」を入力
2. 検索ボタンをクリック

**期待結果:**
- 会社名に「テストA」を含む顧客のみ表示される

**優先度:** 中

---

### 2.6 営業マスタ機能

#### TC-USER-001: 営業登録（正常系）
**前提条件:**
- 上長でログイン済み

**テスト手順:**
1. 営業一覧画面で「新規登録」ボタンをクリック
2. 以下を入力
   - 氏名: 新人太郎
   - メールアドレス: newbie@example.com
   - パスワード: NewPass123!
   - 役割: 一般営業
3. 保存ボタンをクリック

**期待結果:**
- 営業一覧画面に遷移する
- 成功メッセージ「営業を登録しました」が表示される
- 登録した営業が一覧に表示される

**優先度:** 高

---

#### TC-USER-002: 営業登録（メール重複でエラー）
**前提条件:**
- 上長でログイン済み
- staff1@example.com が既に登録済み

**テスト手順:**
1. 営業登録画面を開く
2. メールアドレスに staff1@example.com を入力
3. 他の項目を入力
4. 保存ボタンをクリック

**期待結果:**
- 画面遷移しない
- エラーメッセージ「このメールアドレスは既に使用されています」が表示される

**優先度:** 高

---

#### TC-USER-003: 営業登録（一般営業でエラー）
**前提条件:**
- 一般営業でログイン済み

**テスト手順:**
1. 営業一覧画面へアクセスを試みる

**期待結果:**
- アクセスが拒否される
- エラーメッセージ「この機能にアクセスする権限がありません」が表示される

**優先度:** 高

---

#### TC-USER-004: 営業編集
**前提条件:**
- 上長でログイン済み
- 営業が登録済み

**テスト手順:**
1. 営業一覧から対象の営業の編集ボタンをクリック
2. 氏名を変更
3. 保存ボタンをクリック

**期待結果:**
- 営業一覧画面に遷移する
- 成功メッセージ「営業を更新しました」が表示される
- 変更が反映される

**優先度:** 中

---

#### TC-USER-005: 営業削除
**前提条件:**
- 上長でログイン済み
- 営業が登録済み（日報がない）

**テスト手順:**
1. 営業一覧から対象の営業の削除ボタンをクリック
2. 確認ダイアログで「OK」をクリック

**期待結果:**
- 営業が削除される
- 成功メッセージ「営業を削除しました」が表示される

**優先度:** 中

---

## 3. APIテスト

### 3.1 認証API

#### TC-API-AUTH-001: POST /auth/login（成功）
**リクエスト:**
```json
POST /auth/login
Content-Type: application/json

{
  "email": "staff1@example.com",
  "password": "Test1234!"
}
```

**期待レスポンス:**
```json
HTTP 200 OK

{
  "access_token": "eyJhbGc...",
  "token_type": "Bearer",
  "expires_in": 3600,
  "user": {
    "user_id": 1,
    "name": "田中花子",
    "email": "staff1@example.com",
    "role": "staff"
  }
}
```

**優先度:** 高

---

#### TC-API-AUTH-002: POST /auth/login（失敗）
**リクエスト:**
```json
POST /auth/login
Content-Type: application/json

{
  "email": "staff1@example.com",
  "password": "WrongPassword"
}
```

**期待レスポンス:**
```json
HTTP 401 Unauthorized

{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "メールアドレスまたはパスワードが正しくありません"
  }
}
```

**優先度:** 高

---

### 3.2 日報API

#### TC-API-REPORT-001: POST /reports（成功）
**前提条件:**
- 一般営業でログイン済み（アクセストークン取得済み）

**リクエスト:**
```json
POST /reports
Authorization: Bearer {token}
Content-Type: application/json

{
  "report_date": "2026-01-24",
  "problem": "新規顧客の開拓が難航している",
  "plan": "既存顧客へのフォローアップを強化する",
  "visit_records": [
    {
      "customer_id": 1,
      "visit_content": "新製品の提案を実施"
    },
    {
      "customer_id": 2,
      "visit_content": "既存契約の更新について打ち合わせ"
    }
  ]
}
```

**期待レスポンス:**
```json
HTTP 201 Created

{
  "report_id": 1,
  "user_id": 1,
  "user_name": "田中花子",
  "report_date": "2026-01-24",
  "problem": "新規顧客の開拓が難航している",
  "plan": "既存顧客へのフォローアップを強化する",
  "visit_count": 2,
  "comment_count": 0,
  "created_at": "2026-01-24T18:00:00Z",
  "updated_at": "2026-01-24T18:00:00Z"
}
```

**優先度:** 高

---

#### TC-API-REPORT-002: POST /reports（訪問記録なしでエラー）
**リクエスト:**
```json
POST /reports
Authorization: Bearer {token}
Content-Type: application/json

{
  "report_date": "2026-01-24",
  "problem": "課題",
  "plan": "計画",
  "visit_records": []
}
```

**期待レスポンス:**
```json
HTTP 400 Bad Request

{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "入力値が不正です",
    "details": [
      {
        "field": "visit_records",
        "message": "訪問記録を1件以上追加してください"
      }
    ]
  }
}
```

**優先度:** 高

---

#### TC-API-REPORT-003: GET /reports（一般営業）
**前提条件:**
- 一般営業でログイン済み

**リクエスト:**
```
GET /reports?page=1&per_page=20
Authorization: Bearer {token}
```

**期待レスポンス:**
```json
HTTP 200 OK

{
  "data": [
    {
      "report_id": 1,
      "user_id": 1,
      "user_name": "田中花子",
      "report_date": "2026-01-24",
      ...
    }
  ],
  "pagination": {
    "current_page": 1,
    "per_page": 20,
    "total": 5,
    "total_pages": 1
  }
}
```

**検証項目:**
- 自分の日報のみ返される
- 他のユーザーの日報は含まれない

**優先度:** 高

---

#### TC-API-REPORT-004: GET /reports（上長）
**前提条件:**
- 上長でログイン済み

**リクエスト:**
```
GET /reports?user_id=1&page=1&per_page=20
Authorization: Bearer {manager_token}
```

**期待レスポンス:**
- 全ユーザーの日報が取得できる
- user_idでフィルタリングできる

**優先度:** 高

---

#### TC-API-REPORT-005: PUT /reports/{report_id}（他人の日報で403）
**前提条件:**
- staff1でログイン済み
- staff2の日報が存在（report_id: 10）

**リクエスト:**
```json
PUT /reports/10
Authorization: Bearer {staff1_token}
Content-Type: application/json

{
  "problem": "更新を試みる"
}
```

**期待レスポンス:**
```json
HTTP 403 Forbidden

{
  "error": {
    "code": "FORBIDDEN",
    "message": "この操作を実行する権限がありません"
  }
}
```

**優先度:** 高

---

### 3.3 コメントAPI

#### TC-API-COMMENT-001: POST /reports/{report_id}/comments（上長で成功）
**前提条件:**
- 上長でログイン済み
- 日報が存在（report_id: 1）

**リクエスト:**
```json
POST /reports/1/comments
Authorization: Bearer {manager_token}
Content-Type: application/json

{
  "comment_text": "新規顧客開拓について、来週ミーティングしましょう"
}
```

**期待レスポンス:**
```json
HTTP 201 Created

{
  "comment_id": 1,
  "report_id": 1,
  "user_id": 3,
  "user_name": "山田部長",
  "comment_text": "新規顧客開拓について、来週ミーティングしましょう",
  "created_at": "2026-01-24T20:00:00Z",
  "updated_at": "2026-01-24T20:00:00Z"
}
```

**優先度:** 高

---

#### TC-API-COMMENT-002: POST /reports/{report_id}/comments（一般営業で403）
**前提条件:**
- 一般営業でログイン済み
- 日報が存在（report_id: 1）

**リクエスト:**
```json
POST /reports/1/comments
Authorization: Bearer {staff_token}
Content-Type: application/json

{
  "comment_text": "コメントを試みる"
}
```

**期待レスポンス:**
```json
HTTP 403 Forbidden

{
  "error": {
    "code": "FORBIDDEN",
    "message": "この操作を実行する権限がありません"
  }
}
```

**優先度:** 高

---

## 4. バリデーションテスト

### 4.1 入力値検証

#### TC-VAL-001: メールアドレス形式チェック
**テストデータ:**
| 入力値 | 期待結果 |
|--------|---------|
| test@example.com | OK |
| test@example.co.jp | OK |
| test | NG（エラー: メールアドレスの形式が不正です） |
| test@example | NG（エラー: メールアドレスの形式が不正です） |
| @example.com | NG（エラー: メールアドレスの形式が不正です） |

**優先度:** 中

---

#### TC-VAL-002: パスワード最小文字数チェック
**テストデータ:**
| 入力値 | 期待結果 |
|--------|---------|
| Pass1234 | OK（8文字） |
| Pass123 | NG（エラー: パスワードは8文字以上必要です） |
| 12345678 | OK（8文字） |

**優先度:** 中

---

#### TC-VAL-003: 文字数制限チェック
**テストケース:**
- Problem: 5000文字まで（5001文字でエラー）
- Plan: 5000文字まで（5001文字でエラー）
- visit_content: 2000文字まで（2001文字でエラー）
- comment_text: 2000文字まで（2001文字でエラー）

**優先度:** 中

---

#### TC-VAL-004: 電話番号形式チェック
**テストデータ:**
| 入力値 | 期待結果 |
|--------|---------|
| 03-1234-5678 | OK |
| 090-1234-5678 | OK |
| 0312345678 | OK |
| abc-defg-hijk | NG（エラー: 電話番号の形式が不正です） |

**優先度:** 低

---

### 4.2 必須項目チェック

#### TC-VAL-005: 日報作成時の必須項目
**テストケース:**
| 項目 | 必須 | 未入力時のエラーメッセージ |
|------|------|--------------------------|
| report_date | ○ | 報告日は必須です |
| problem | × | - |
| plan | × | - |
| visit_records | ○ | 訪問記録を1件以上追加してください |

**優先度:** 高

---

#### TC-VAL-006: 顧客登録時の必須項目
**テストケース:**
| 項目 | 必須 | 未入力時のエラーメッセージ |
|------|------|--------------------------|
| company_name | ○ | 会社名は必須です |
| contact_person | × | - |
| phone | × | - |
| email | × | - |
| address | × | - |

**優先度:** 中

---

## 5. 権限テスト

### 5.1 役割ベースアクセス制御

#### TC-PERM-001: 一般営業の権限
**テストケース:**
| 機能 | アクセス権限 | 期待結果 |
|------|------------|---------|
| 自分の日報作成 | ○ | 成功 |
| 自分の日報編集 | ○ | 成功（7日以内） |
| 自分の日報削除 | ○ | 成功（7日以内） |
| 他人の日報閲覧 | × | 403 Forbidden |
| 他人の日報編集 | × | 403 Forbidden |
| コメント投稿 | × | 403 Forbidden |
| 顧客マスタ管理 | ○ | 成功 |
| 営業マスタ閲覧 | × | 403 Forbidden |
| 営業マスタ管理 | × | 403 Forbidden |

**優先度:** 高

---

#### TC-PERM-002: 上長の権限
**テストケース:**
| 機能 | アクセス権限 | 期待結果 |
|------|------------|---------|
| 自分の日報作成 | ○ | 成功 |
| 全日報閲覧 | ○ | 成功 |
| 他人の日報編集 | × | 403 Forbidden |
| コメント投稿 | ○ | 成功 |
| 顧客マスタ管理 | ○ | 成功 |
| 営業マスタ閲覧 | ○ | 成功 |
| 営業マスタ管理 | ○ | 成功 |

**優先度:** 高

---

#### TC-PERM-003: 未認証ユーザー
**テストケース:**
| エンドポイント | 期待結果 |
|---------------|---------|
| GET /reports | 401 Unauthorized |
| POST /reports | 401 Unauthorized |
| GET /customers | 401 Unauthorized |
| POST /auth/logout | 401 Unauthorized |

**優先度:** 高

---

## 6. 非機能テスト

### 6.1 パフォーマンステスト

#### TC-PERF-001: 画面表示速度
**テストケース:**
| 画面 | 目標時間 | 測定方法 |
|------|---------|---------|
| ログイン画面 | 2秒以内 | DOMContentLoaded |
| ダッシュボード | 3秒以内 | ページ完全読み込み |
| 日報一覧（20件） | 3秒以内 | ページ完全読み込み |
| 日報詳細 | 3秒以内 | ページ完全読み込み |

**優先度:** 中

---

#### TC-PERF-002: API応答時間
**テストケース:**
| エンドポイント | 目標時間 | データ量 |
|---------------|---------|---------|
| POST /auth/login | 500ms以内 | - |
| GET /reports | 2秒以内 | 100件 |
| POST /reports | 1秒以内 | 訪問記録5件 |
| GET /customers | 2秒以内 | 1000件 |

**優先度:** 中

---

#### TC-PERF-003: 大量データ検索
**テストケース:**
- 日報10,000件が存在する状態で検索
- 期待結果: 5秒以内にレスポンスが返る

**優先度:** 低

---

### 6.2 セキュリティテスト

#### TC-SEC-001: XSS対策
**テストケース:**
1. Problem欄に `<script>alert('XSS')</script>` を入力
2. 日報を保存
3. 日報詳細画面で表示

**期待結果:**
- スクリプトが実行されない
- エスケープされて表示される

**優先度:** 高

---

#### TC-SEC-002: SQLインジェクション対策
**テストケース:**
1. 顧客検索で `'; DROP TABLE customers; --` を入力
2. 検索を実行

**期待結果:**
- テーブルが削除されない
- 安全にエスケープ処理される

**優先度:** 高

---

#### TC-SEC-003: CSRF対策
**テストケース:**
1. 別サイトから日報作成APIを呼び出し

**期待結果:**
- CSRFトークンがない場合、403 Forbiddenが返される

**優先度:** 高

---

#### TC-SEC-004: パスワードハッシュ化
**テストケース:**
1. ユーザーを登録
2. データベースのパスワードカラムを確認

**期待結果:**
- パスワードが平文で保存されていない
- bcrypt等でハッシュ化されている

**優先度:** 高

---

#### TC-SEC-005: JWTトークンの有効期限
**テストケース:**
1. ログインしてトークンを取得
2. 1時間1分後にAPIを呼び出し

**期待結果:**
- 401 Unauthorizedが返される
- エラーメッセージ「トークンの有効期限が切れています」

**優先度:** 中

---

### 6.3 ブラウザ互換性テスト

#### TC-BROWSER-001: 各ブラウザでの動作確認
**テストケース:**
- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）

**確認項目:**
- ログイン、日報作成、コメント投稿が正常に動作する
- レイアウトが崩れない
- JavaScriptエラーが発生しない

**優先度:** 中

---

### 6.4 レスポンシブデザインテスト

#### TC-RESPONSIVE-001: スマートフォン表示
**テストケース:**
- iPhone 12 Pro（375×812）
- iPhone 14 Pro Max（430×932）
- Android（360×640）

**確認項目:**
- 各画面が適切に表示される
- ボタンが押しやすいサイズで表示される
- テーブルが横スクロール可能

**優先度:** 中

---

#### TC-RESPONSIVE-002: タブレット表示
**テストケース:**
- iPad（768×1024）
- iPad Pro（1024×1366）

**確認項目:**
- レイアウトが適切に調整される
- タッチ操作が可能

**優先度:** 低

---

## 7. データ整合性テスト

#### TC-DATA-001: 日報削除時のカスケード削除
**テストケース:**
1. 日報を作成（訪問記録3件、コメント2件）
2. 日報を削除

**期待結果:**
- 日報が削除される
- 関連する訪問記録3件が削除される
- 関連するコメント2件が削除される

**優先度:** 高

---

#### TC-DATA-002: 同じ日付での日報重複防止
**テストケース:**
1. staff1で2026-01-24の日報を作成
2. 再度staff1で2026-01-24の日報を作成

**期待結果:**
- 2回目の作成が失敗する
- エラーメッセージ「この日付の日報は既に作成されています」

**優先度:** 高

---

#### TC-DATA-003: 訪問記録の順序保持
**テストケース:**
1. 日報を作成（訪問記録を順不同で3件追加）
2. 日報詳細を表示

**期待結果:**
- visit_orderフィールドの値に従って表示される
- 入力順序が保持される

**優先度:** 中

---

## 8. テスト実施記録

### 8.1 テスト実施表

| テストケースID | テスト項目 | 実施日 | 担当者 | 結果 | 備考 |
|--------------|-----------|--------|--------|------|------|
| TC-AUTH-001 | ログイン成功（一般営業） | | | | |
| TC-AUTH-002 | ログイン成功（上長） | | | | |
| TC-AUTH-003 | ログイン失敗（パスワード誤り） | | | | |
| ... | ... | | | | |

**結果の記入方法:**
- ✓: 合格
- ×: 不合格
- -: 未実施
- △: 条件付き合格

### 8.2 不具合管理

| 不具合ID | テストケースID | 概要 | 深刻度 | ステータス | 担当者 |
|---------|--------------|------|--------|----------|--------|
| BUG-001 | TC-REPORT-001 | 日報作成時に500エラー | 高 | 修正中 | 開発太郎 |
| ... | ... | ... | ... | ... | ... |

**深刻度:**
- 高: システムが使用不可能
- 中: 主要機能に影響
- 低: 軽微な問題

---

## 9. テスト完了基準

### 9.1 合格基準
- 優先度「高」のテストケース: 100%合格
- 優先度「中」のテストケース: 95%以上合格
- 優先度「低」のテストケース: 90%以上合格
- 深刻度「高」の不具合: 0件
- 深刻度「中」の不具合: 3件以下

### 9.2 リリース判定
上記の合格基準を満たし、かつ以下の条件を満たすこと:
- セキュリティテストがすべて合格
- 主要ブラウザでの動作確認完了
- パフォーマンステストが目標値を達成

---

## 10. 補足

### 10.1 テスト環境のセットアップ
```bash
# データベースの初期化
npm run db:reset

# テストデータの投入
npm run db:seed

# テストサーバーの起動
npm run test:server
```

### 10.2 自動テストの実行
```bash
# 単体テスト
npm run test:unit

# 結合テスト
npm run test:integration

# E2Eテスト
npm run test:e2e

# 全テスト実行
npm run test:all
```

### 10.3 テストツール
- 単体テスト: Jest / Vitest
- E2Eテスト: Playwright / Cypress
- APIテスト: Postman / REST Client
- パフォーマンステスト: Lighthouse / JMeter
- セキュリティテスト: OWASP ZAP

---

## 変更履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|---------|--------|
| 1.0.0 | 2026-01-24 | 初版作成 | |
